@defer {
  @if (comments(); as comments) {
    <mat-accordion>
      <mat-expansion-panel
        (opened)="panelState.set(true)"
        (closed)="panelState.set(false)"
      >
        <mat-expansion-panel-header>
          <mat-panel-title i18n="@@blog-post-comment.title">
            Comments ({{ comments.length }})
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="comments-list">
          @for (comment of comments; track comment.id) {
            <div class="comment-card">
              <div class="comment-content">
                <p class="comment-text">{{ comment.content }}</p>
                @if (comment.author.id === currentUser?.id) {
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="deleteComment(comment.id)"
                    class="delete-btn"
                    matTooltip="Delete comment"
                    i18n-matTooltip="@@blog-post-comment.delete-tooltip"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                }
              </div>
              <div class="comment-meta">
                <mat-chip disableRipple>
                  <ng-container i18n="@@blog-post-comment.user-label"
                    >User: {{ comment.author.username }}</ng-container
                  >
                </mat-chip>
                <mat-chip disableRipple>
                  <ng-container i18n="@@blog-post-comment.created-label"
                    >Created:
                    {{ comment.createdAt | date: 'medium' }}</ng-container
                  >
                </mat-chip>
                @if (comment.updatedAt !== comment.createdAt) {
                  <mat-chip disableRipple>
                    <ng-container i18n="@@blog-post-comment.updated-label"
                      >Updated:
                      {{ comment.updatedAt | date: 'medium' }}</ng-container
                    >
                  </mat-chip>
                }
              </div>
              <div
                class="vote-controls"
                title="Total votes"
                i18n-title="@@blog-post-comment.vote-count-tooltip"
              >
                <mat-icon aria-hidden="true" color="primary">thumb_up</mat-icon>
                <span class="vote-count">{{ getVotesCount(comment.id) }}</span>
              </div>
            </div>
          } @empty {
            <div class="no-comments">
              <p i18n="@@blog-post-comment.no-comments">
                No comments yet. Be the first to comment!
              </p>
            </div>
          }
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  }
} @loading {
  <div class="loading-state">
    <div class="spinner"></div>
    <p i18n="@@blog-post-comment.loading">Loading comments...</p>
  </div>
}
